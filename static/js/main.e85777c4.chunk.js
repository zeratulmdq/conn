(this.webpackJsonpdiagraming=this.webpackJsonpdiagraming||[]).push([[0],{11:function(t,e,n){t.exports=n(18)},16:function(t,e,n){},17:function(t,e,n){},18:function(t,e,n){"use strict";n.r(e);var i=n(1),a=n.n(i),r=n(9),o=n.n(r),c=(n(16),n(10)),s=n(2),l=n(0),d=n(3),h=n(4),u=n(6),g=n(5),p=(n(17),n(8),function(t){Object(u.a)(n,t);var e=Object(g.a)(n);function n(){var t;Object(d.a)(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(t=e.call.apply(e,[this].concat(a))).dragging=!1,t.initialX=0,t.initialY=0,t.handleClick=function(e){var n=t.props;(0,n.onClick)(n.widget.id,e)},t.handleDragStart=function(e){var n=t.props;(0,n.onDragStart)(n.widget.id,e)},t.handleMouseHover=function(e){var n=t.props;(0,n.onMouseHover)(n.widget.id,e)},t.handleMouseLeave=function(e){var n=t.props;(0,n.onMouseLeave)(n.widget.id,e)},t}return Object(h.a)(n,[{key:"render",value:function(){var t=this.props,e=t.cursor,n=t.selected,i=t.widget,r=i.x,o=i.y,c=i.width,s=i.height;return a.a.createElement("div",{onClick:this.handleClick,onMouseDown:this.handleDragStart,onMouseMove:this.handleMouseHover,onMouseLeave:this.handleMouseLeave,style:{top:o,left:r,width:c,height:s,cursor:"crosshair"===e?"crosshair":"pointer",border:n?"2px solid blue":"none"},className:"Sticky"})}}]),n}(a.a.Component)),y=function(t){Object(u.a)(n,t);var e=Object(g.a)(n);function n(){return Object(d.a)(this,n),e.apply(this,arguments)}return Object(h.a)(n,[{key:"render",value:function(){return a.a.createElement("svg",{style:{position:"absolute",top:0,left:0,pointerEvents:"none"},xmlns:"http://www.w3.org/2000/svg",version:"1.1"},function(t,e){var n=t[0],i=t[1],r="right"===n.type||"left"===n.type,o="right"===i.type||"left"===i.type;if(r&&n.y===i.y||!r&&n.x===i.x){var c="M ".concat(n.x," ").concat(n.y," L ").concat(i.x," ").concat(i.y);return[a.a.createElement("path",{d:c,stroke:"red",strokeWidth:"2",fill:"none"}),a.a.createElement("circle",{cx:"".concat(i.x),cy:"".concat(i.y),r:"5",stroke:"#5cb85c",fill:"#5cb85c"})]}if(r!==o){var s="".concat(n.x," ").concat(n.y),l=r?"".concat(i.x," ").concat(n.y):"".concat(n.x," ").concat(i.y),d="".concat(i.x," ").concat(i.y),h="M ".concat(s," L ").concat(l),u="M ".concat(l," L ").concat(d);return[a.a.createElement("path",{d:h,stroke:"red",strokeWidth:"2",fill:"none"}),a.a.createElement("path",{d:u,stroke:"red",strokeWidth:"2",fill:"none"}),a.a.createElement("circle",{cx:"".concat(i.x),cy:"".concat(i.y),r:"5",stroke:"#5cb85c",fill:"#5cb85c"})]}var g=r?(i.x-n.x)/2:(i.y-n.y)/2,p=r?n.x+g:n.y+g;if(e){var y="manyToOne"===e.type?i:n;e.convergenceSide===y.type&&(p=e.position)}var f="".concat(n.x," ").concat(n.y),w=r?"".concat(p," ").concat(n.y):" ".concat(n.x," ").concat(p),v=r?"".concat(p," ").concat(i.y):" ".concat(i.x," ").concat(p),b="".concat(i.x," ").concat(i.y),x="M ".concat(f," L ").concat(w),O="M ".concat(w," L ").concat(v),j="M ".concat(v," L ").concat(b);return[a.a.createElement("path",{d:x,stroke:"red",strokeWidth:"2",fill:"none"}),a.a.createElement("path",{d:O,stroke:"red",strokeWidth:"2",fill:"none"}),a.a.createElement("path",{d:j,stroke:"red",strokeWidth:"2",fill:"none"}),a.a.createElement("circle",{cx:"".concat(i.x),cy:"".concat(i.y),r:"5",stroke:"#5cb85c",fill:"#5cb85c"})]}(this.props.widget.points,this.props.widget.chartBranch))}}]),n}(a.a.PureComponent),f=function(t){Object(u.a)(n,t);var e=Object(g.a)(n);function n(){var t;Object(d.a)(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(t=e.call.apply(e,[this].concat(a))).state={checked:!1},t.handleOnChange=function(e){t.setState((function(e){var n=!e.checked;return t.props.onCheckedChange(n),{checked:n}}))},t}return Object(h.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{style:{height:"auto"}},a.a.createElement("label",null,a.a.createElement("input",{type:"checkbox",style:{width:15,height:15},onChange:this.handleOnChange,defaultChecked:this.state.checked}),this.props.label))}}]),n}(a.a.PureComponent),w=n(20),v=function(t){var e,n;return{id:w.a(),height:null!==(e=t.height)&&void 0!==e?e:100,width:null!==(n=t.width)&&void 0!==n?n:100,type:"sticky",x:(t.x||0)-50,y:(t.y||0)-50}},b=function(t){return{id:w.a(),height:0,width:0,type:"arrow",x:(t.x||0)-25,y:(t.y||0)-25,start:t.start||null,end:t.end||null,points:[],arrowType:t.arrowType||"initial",chartBranch:null,initialIsHorizontal:t.initialIsHorizontal||!0}},x=function(t){return"left"===t||"right"===t?"horizontal":"vertical"},O={position:"absolute",top:0,width:"auto",height:"auto",borderStyle:"solid",backgroundColor:"lightgray",padding:10},j=function(t){Object(u.a)(n,t);var e=Object(g.a)(n);function n(){var t;Object(d.a)(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(t=e.call.apply(e,[this].concat(a))).ref=null,t.state={settings:{stickToConvergentWidgetSide:!1},cursor:"auto",dragging:null,initialId:null,initialX:null,initialY:null,lastX:null,lastY:null,selected:null,widgets:{}},t.handleClick=function(e){e.preventDefault(),e.stopPropagation(),t.state.initialId&&t.cancelArrowCreation()},t.handleStickyClick=function(e,n){if(n.preventDefault(),n.stopPropagation(),t.state.initialId!==e){if("crosshair"===t.state.cursor)if(t.state.initialId)t.setState((function(n){var i,a;if(!n.dragging)return Object(l.a)({},n);var r=Object(l.a)({},n.widgets[n.dragging[0]]),o=n.widgets[null!==(i=r.start)&&void 0!==i?i:e],c=n.widgets[null!==(a=r.end)&&void 0!==a?a:e];if(Object.values(n.widgets).find((function(t){return"arrow"===t.type&&t.id!==r.id&&t.start===o.id&&t.end===c.id})))return Object(l.a)({},n);var d=Math.abs((o.x-c.x)/(o.y-c.y))>1;return r.start=o.id,r.end=c.id,r.initialIsHorizontal=d,t.updateArrow(r,n.widgets),Object(l.a)(Object(l.a)({},n),{},{cursor:"auto",dragging:null,initialId:null,widgets:Object(l.a)(Object(l.a)({},n.widgets),{},Object(s.a)({},r.id,r))})}));else{var i={x:n.clientX,y:n.clientY};t.setState((function(n){var a=Object(l.a)({},b({start:e,end:null}));return t.updateDisconnectedArrow(a,n.widgets,i),Object(l.a)(Object(l.a)({},n),{},{initialId:e,widgets:Object(l.a)(Object(l.a)({},n.widgets),{},Object(s.a)({},a.id,a)),dragging:[a.id],initialX:i.x,initialY:i.y,lastX:i.x,lastY:i.y})}))}}else t.cancelArrowCreation()},t.handleDoubleClick=function(e){var n=e.ctrlKey?150:100,i=v({x:e.clientX,y:e.clientY,width:n});t.setState((function(t){return{selected:[i.id],widgets:Object(l.a)(Object(l.a)({},t.widgets),{},Object(s.a)({},i.id,i))}}))},t.handleDrag=function(e){var n={x:e.clientX,y:e.clientY};t.setState((function(e){if(!e.dragging||!e.lastX||!e.lastY)return Object(l.a)({},e);var i=e.dragging.map((function(t){return e.widgets[t]}));if(i.length>1||"sticky"===i[0].type){var a=n.x-e.lastX,r=n.y-e.lastY,o=Object.values(e.widgets).filter((function(t){return"arrow"===t.type&&e.dragging&&(t.start&&e.dragging.includes(t.start)||t.end&&e.dragging.includes(t.end))})).reduce((function(n,i){var o=i;return t.updateArrow(o,e.widgets),e.dragging&&o.start&&e.dragging.includes(o.start)&&o.end&&e.dragging.includes(o.end)&&o.chartBranch&&"oneToOne"===o.chartBranch.type&&(o.chartBranch.position=o.chartBranch.position+(o.initialIsHorizontal?a/2:r/2)),Object(l.a)(Object(l.a)({},n),{},Object(s.a)({},o.id,Object(l.a)({},o)))}),{});console.log({connectedArrows:o}),console.log({deltaX:a});var c=i.reduce((function(t,e){return Object(l.a)(Object(l.a)({},t),{},Object(s.a)({},e.id,Object(l.a)(Object(l.a)({},e),{},{x:e.x+a,y:e.y+r})))}),{});return Object(l.a)(Object(l.a)({},e),{},{lastX:n.x,lastY:n.y,widgets:Object(l.a)(Object(l.a)(Object(l.a)({},e.widgets),c),o)})}if("arrow"===i[0].type){var d=Object(l.a)({},i[0]);return t.updateDisconnectedArrow(d,e.widgets,n),{lastX:n.x,lastY:n.y,widgets:Object(l.a)(Object(l.a)({},e.widgets),{},Object(s.a)({},d.id,d))}}return Object(l.a)({},e)}))},t.handleMouseHoverSticky=function(e,n){var i={x:n.clientX,y:n.clientY};t.setState((function(n){if(!n.dragging||!n.lastX||!n.lastY)return Object(l.a)({},n);var a=n.dragging.map((function(t){return n.widgets[t]}));if(1===a.length&&"arrow"===a[0].type&&a[0].start!==e&&a[0].end!==e){var r,o,c=Object(l.a)({},a[0]);return c.start=null!==(r=c.start)&&void 0!==r?r:e,c.end=null!==(o=c.end)&&void 0!==o?o:e,t.updateArrow(c,n.widgets),{lastX:i.x,lastY:i.y,widgets:Object(l.a)(Object(l.a)({},n.widgets),{},Object(s.a)({},c.id,c))}}return Object(l.a)({},n)}))},t.handleMouseLeaveSticky=function(e,n){var i={x:n.clientX,y:n.clientY};t.setState((function(n){if(!n.dragging||!n.lastX||!n.lastY)return Object(l.a)({},n);var a=n.dragging.map((function(t){return n.widgets[t]}));if(1===a.length&&"arrow"===a[0].type&&a[0].start&&a[0].end&&(a[0].start===e||a[0].end===e)){var r=Object(l.a)({},a[0]);return r.start=r.start===e?null:r.start,r.end=r.end===e?null:r.end,t.updateDisconnectedArrow(r,n.widgets,i),{lastX:i.x,lastY:i.y,widgets:Object(l.a)(Object(l.a)({},n.widgets),{},Object(s.a)({},r.id,r))}}return Object(l.a)({},n)}))},t.handleWidgetDragStart=function(e,n){var i=n.clientX,a=n.clientY,r=n.shiftKey;if(n.stopPropagation(),0===n.button&&!t.state.dragging){var o=t.state.selected&&(t.state.selected.includes(e)||r)?t.state.selected.includes(e)?t.state.selected:[].concat(Object(c.a)(t.state.selected),[e]):[e],s=t.state.selected&&t.state.selected.includes(e)?t.state.selected:[e];t.setState({dragging:s,selected:o,initialX:i,initialY:a,lastX:i,lastY:a})}},t.handleKeyDown=function(e){if("c"===e.key){var n="auto"===t.state.cursor?"crosshair":"auto";"auto"===n?t.cancelArrowCreation():t.setState({cursor:n})}"Backspace"!==e.key&&"Delete"!==e.key||!t.state.selected||t.setState((function(t){var e=t.selected||null,n=t.widgets;return null===e||void 0===e||e.forEach((function(t){Object.values(n).forEach((function(e){"arrow"!==e.type||e.start!==t&&e.end!==t||delete n[e.id]})),delete n[t]})),Object(l.a)(Object(l.a)({},t),{},{selected:null,widgets:Object(l.a)({},n)})}))},t.handleMouseDown=function(){t.setState({selected:null})},t.handleMouseUp=function(e){t.setState((function(e){if(!e.dragging)return Object(l.a)({},e);var n=e.dragging.map((function(t){return e.widgets[t]}));if(1===n.length&&"arrow"===n[0].type)return Object(l.a)({},e);var i=Object.values(e.widgets).filter((function(t){var n,i;return"arrow"===t.type&&(t.start&&(null===(n=e.dragging)||void 0===n?void 0:n.includes(t.start))||t.end&&(null===(i=e.dragging)||void 0===i?void 0:i.includes(t.end)))})).map((function(t){return t})).reduce((function(n,i){if(!e.settings.stickToConvergentWidgetSide||"chartBranch"!==i.arrowType){if(t.isChartSideArrow(i,e.widgets)){var a=e.widgets[i.start||""],r=e.widgets[i.end||""];t.updateArrowChartSide(i,a,r)&&(i.arrowType="chartSide")}t.setArrowChartBranch(i,e.widgets,!1)}return i.initialIsHorizontal="left"===i.points[0].type||"right"===i.points[0].type,Object(l.a)(Object(l.a)({},n),{},Object(s.a)({},i.id,Object(l.a)({},i)))}),{});return{dragging:null,widgets:Object(l.a)(Object(l.a)({},e.widgets),i)}}))},t.handleRef=function(e){t.ref=e,t.ref&&t.ref.focus()},t}return Object(h.a)(n,[{key:"cancelArrowCreation",value:function(){this.setState((function(t){if(t.dragging&&t.dragging.length){var e=Object(l.a)({},t.widgets[t.dragging[0]]);if("arrow"===e.type){var n=t.widgets;return delete n[e.id],Object(l.a)(Object(l.a)({},t),{},{dragging:null,initialId:null,cursor:"auto",widgets:Object(l.a)({},n)})}}return Object(l.a)(Object(l.a)({},t),{},{dragging:null,initialId:null,cursor:"auto"})}))}},{key:"setArrowChartBranch",value:function(t,e,n){if(!this.state.settings.stickToConvergentWidgetSide&&t.chartBranch&&("manyToOne"===t.chartBranch.type?t.points[1]:t.points[0]).type===t.chartBranch.convergenceSide)return;var i=this.getSharedChartBranchArrow(t,e);if(!n||i)if(n||(t.arrowType="chartBranch"),i&&i.chartBranch)"oneToOne"===i.chartBranch.type&&(i.start===t.start?(i.chartBranch.type="oneToMany",i.chartBranch.convergenceSide=t.points[0].type):(i.chartBranch.type="manyToOne",i.chartBranch.convergenceSide=t.points[1].type)),t.chartBranch=Object.assign({},i.chartBranch);else{var a={position:0,convergenceSide:t.points[0].type,type:"oneToOne"};"horizontal"===x(a.convergenceSide)?a.position=t.points[0].x+(t.points[1].x-t.points[0].x)/2:a.position=t.points[0].y+(t.points[1].y-t.points[0].y)/2,t.chartBranch=a}else t.chartBranch=null}},{key:"getSharedChartBranchArrow",value:function(t,e){var n=Object.values(e).filter((function(e){return"arrow"===e.type&&e.id!==t.id&&"chartBranch"===e.arrowType&&e.chartBranch&&(e.start===t.start&&e.points[0].type===t.points[0].type||e.end===t.end&&e.points[1].type===t.points[1].type)})).map((function(t){return t}));return n.length>0?n[0]:null}},{key:"updateDisconnectedArrow",value:function(t,e,n){var i=e[t.start||""],a=e[t.end||""],r=i||a,o=i?{x:i.x,y:i.y}:n,c=a?{x:a.x,y:a.y}:n,s=[{type:"right",x:0,y:0},{type:"left",x:1,y:0}];Math.abs((o.x-c.x)/(o.y-c.y))>1?r.x+r.width+10<n.x?(s[0].type=i?"right":"left",s[1].type=i?"left":"right"):(s[0].type=i?"left":"right",s[1].type=i?"right":"left"):r.y+r.height+10<n.y?(s[0].type=i?"bottom":"top",s[1].type=i?"top":"bottom"):(s[0].type=i?"top":"bottom",s[1].type=i?"bottom":"top"),s[0]=i?this.getWidgetSideMidPosition(s[0],i):Object(l.a)(Object(l.a)({},s[0]),{},{x:n.x,y:n.y}),s[1]=a?this.getWidgetSideMidPosition(s[1],a):Object(l.a)(Object(l.a)({},s[1]),{},{x:n.x,y:n.y}),t.points=s}},{key:"updateArrow",value:function(t,e){var n=e[t.start||""],i=e[t.end||""],a=[{type:"right",x:0,y:0},{type:"left",x:1,y:0}];(2===t.points.length&&(a=t.points),this.state.settings.stickToConvergentWidgetSide&&"chartBranch"===t.arrowType)||(Math.abs((n.x-i.x)/(n.y-i.y))>1?n.x+n.width+10<i.x?(a[0].type="right",a[1].type="left"):(a[0].type="left",a[1].type="right"):n.y+n.height+10<i.y?(a[0].type="bottom",a[1].type="top"):(a[0].type="top",a[1].type="bottom"),a[0]=this.getWidgetSideMidPosition(a[0],n),a[1]=this.getWidgetSideMidPosition(a[1],i),t.points=a,this.isChartSideArrow(t,e)&&this.updateArrowChartSide(t,n,i),this.setArrowChartBranch(t,e,!0));if(t.chartBranch){var r="manyToOne"===t.chartBranch.type,o=r?t.points[1]:t.points[0],c=r?t.points[0]:t.points[1],s=r?i:n,l=r?n:i;o=this.getWidgetSideMidPosition(o,s),c=this.getWidgetSideMidPosition(c,l),"horizontal"===x(t.chartBranch.convergenceSide)?t.chartBranch.position>=l.x&&t.chartBranch.position<=l.x+l.width?(c.x=t.chartBranch.position,c.y=l.y+l.height/2>o.y?l.y:l.y+l.height):(c.type=t.chartBranch.position<l.x?"left":"right",c=this.getWidgetSideMidPosition(c,l)):t.chartBranch.position>=l.y&&t.chartBranch.position<=l.y+l.height?(c.x=l.x+l.width/2>o.x?l.x:l.x+l.width,c.y=t.chartBranch.position):(c.type=t.chartBranch.position<l.y?"top":"bottom",c=this.getWidgetSideMidPosition(c,l)),t.points[0]=r?c:o,t.points[1]=r?o:c}}},{key:"isChartSideArrow",value:function(t,e){if(!this.getSharedChartBranchArrow(t,e))return t.initialIsHorizontal&&("top"===t.points[0].type||"bottom"===t.points[0].type)||!t.initialIsHorizontal&&("left"===t.points[0].type||"right"===t.points[0].type)}},{key:"updateArrowChartSide",value:function(t,e,n){if(t.initialIsHorizontal){var i=this.getIntersectionMiddle(e.x,e.width,n.x,n.width);if(i)return t.points[0].x=i,t.points[1].x=i,!0}else{var a=this.getIntersectionMiddle(e.y,e.height,n.y,n.height);if(a)return t.points[0].y=a,t.points[1].y=a,!0}t.initialIsHorizontal?t.points[0].type=n.x>e.x+e.width/2?"right":"left":t.points[0].type=n.y>e.y+e.height/2?"bottom":"top",t.points[0]=this.getWidgetSideMidPosition(t.points[0],e);var r=e.x+e.width/2,o=e.y+e.height/2,c=n.x+n.width/2,s=n.y+n.height/2,l=Math.abs(r-c)-(e.width/2+n.width/2),d=Math.abs(o-s)-(e.height/2+n.height/2);if(t.initialIsHorizontal?l<=10:d<=10)if(t.initialIsHorizontal){t.points[1].type=n.y>t.points[0].y?"top":"bottom";var h=e.width/2+Math.max(l+10,20);t.points[1].x=r+("right"===t.points[0].type?h:-h),t.points[1].y="top"===t.points[1].type?n.y:n.y+n.height}else{t.points[1].type=n.x>t.points[0].x?"left":"right";var u=e.height/2+Math.max(d+10,20);t.points[1].x="left"===t.points[1].type?n.x:n.x+n.width,t.points[1].y=o+("bottom"===t.points[0].type?u:-u)}else t.initialIsHorizontal?t.points[1].type="right"===t.points[0].type?"left":"right":t.points[1].type="bottom"===t.points[0].type?"top":"bottom",t.points[1]=this.getWidgetSideMidPosition(t.points[1],n);return!1}},{key:"widgetsTooClose",value:function(t,e,n,i){var a=t.x+t.width/2,r=t.y+t.height/2,o=e.x+e.width/2,c=e.y+e.height/2;return i?Math.abs(a-o)-(t.width/2+e.width/2)<=n:Math.abs(r-c)-(t.height/2+e.height/2)<=n}},{key:"getIntersectionMiddle",value:function(t,e,n,i){var a=t+e,r=n+i;if(t===n&&a===r||t>n&&t<r){var o=r-t;return o<=20?null:t+o/2}if(a>n&&a<r){var c=a-n;return c<=20?null:a-c/2}return null}},{key:"between",value:function(t,e,n){return t>e&&t<n}},{key:"getWidgetSideMidPosition",value:function(t,e){var n={type:t.type,x:0,y:0};switch(t.type){case"top":n.x=e.x+e.width/2,n.y=e.y;break;case"right":n.x=e.x+e.width,n.y=e.y+e.height/2;break;case"bottom":n.x=e.x+e.width/2,n.y=e.y+e.height;break;case"left":n.x=e.x,n.y=e.y+e.height/2}return n}},{key:"render",value:function(){var t=this,e=this.state,n=e.cursor,i=e.selected,r=e.widgets;return a.a.createElement("div",null,a.a.createElement("div",{id:"canvas",style:{cursor:n},className:"App",tabIndex:1,onClick:this.handleClick,onDoubleClick:this.handleDoubleClick,onKeyDown:this.handleKeyDown,onMouseMove:this.handleDrag,onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,ref:this.handleRef},Object.values(r).map((function(e){return"sticky"===e.type?a.a.createElement(p,{cursor:n,onClick:t.handleStickyClick,onDragStart:t.handleWidgetDragStart,onMouseHover:t.handleMouseHoverSticky,onMouseLeave:t.handleMouseLeaveSticky,selected:!!(null===i||void 0===i?void 0:i.includes(e.id)),widget:e,key:e.id}):"arrow"===e.type?a.a.createElement(y,{widget:e,key:e.id}):null}))),a.a.createElement("div",{id:"settings",style:O},a.a.createElement(f,{label:"Stick To Convergent Widget Side",onCheckedChange:function(e){return t.setState({settings:{stickToConvergentWidgetSide:e}})}})))}}]),n}(a.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(j,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))},8:function(t,e,n){}},[[11,1,2]]]);
//# sourceMappingURL=main.e85777c4.chunk.js.map